---
volumes:
  nordlynx_config:

networks:
  networks_vpn_net:
    external: true
  networks_infra_net:
    external: true

services:
  # ðŸ”’ NordLynx (WireGuard de NordVPN)
  nordlynx:
    image: ghcr.io/bubuntux/nordlynx:latest
    container_name: nordlynx
    restart: unless-stopped
    cap_add:
      - NET_ADMIN
      - NET_RAW
    sysctls:
      - net.ipv6.conf.all.disable_ipv6=1
    environment:
      - PRIVATE_KEY=${NORDLYNX_PRIVATE_KEY}
      - NET_LOCAL=192.168.3.0/24 192.168.5.0/24
      - DNS=103.86.96.100,103.86.99.100
    volumes:
      - nordlynx_config:/config
    ports:
      - "8585:8585"
    networks:
      - networks_vpn_net
      - networks_infra_net

  # ðŸ’¾ qBittorrent â€” routed through NordLynx
  qbittorrent:
    image: lscr.io/linuxserver/qbittorrent:latest
    container_name: qbittorrent
    restart: unless-stopped
    depends_on:
      - nordlynx
    network_mode: "service:nordlynx"
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/Mexico_City
      - WEBUI_PORT=8585
    volumes:
      - /mnt/HomeLab/QBittorrent/config:/config
      - /mnt/media/downloads:/downloads

  # ðŸ”„ Nginx Reverse Proxy for VPN-routed services (qBittorrent, Firefox)
  # nginx-proxy:
  #   image: nginx:alpine
  #   container_name: nginx-proxy
  #   restart: unless-stopped
  #   ports:
  #     - "8585:8585"
  #     - "3080:3080"
  #   networks:
  #     - networks_infra_net
  #   volumes:
  #     - ./nginx.conf:/etc/nginx/nginx.conf:ro
  #   sysctls:
  #     - net.ipv6.conf.all.disable_ipv6=1
  #     - net.ipv6.conf.lo.disable_ipv6=1
  #   depends_on:
  #     - qbittorrent
  #     - firefox

  # firefox:
  #   image: lscr.io/linuxserver/firefox:latest
  #   container_name: firefox
  #   restart: unless-stopped
  #   depends_on:
  #       - nordlynx
  #   networks:
  #     - networks_vpn_net
  #     - networks_infra_net
  #   environment:
  #       - PUID=1000
  #       - PGID=1000
  #       - TZ=America/Mexico_City
  #   volumes:
  #     - /mnt/HomeLab/Privacy/Firefox/config:/config
  #   expose:
  #     - "3000"
  #   security_opt:
  #       - seccomp:unconfined
  #   shm_size: "1gb"

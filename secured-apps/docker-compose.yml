---
volumes:
  nordlynx_config:

networks:
  networks_vpn_net:
    external: true
  networks_infra_net:
    external: true

services:
  # ðŸ”’ NordLynx (WireGuard de NordVPN)
  nordlynx:
    image: ghcr.io/bubuntux/nordlynx:latest
    container_name: nordlynx
    restart: unless-stopped
    cap_add:
      - NET_ADMIN
      - NET_RAW
    sysctls:
      - net.ipv6.conf.all.disable_ipv6=1
    environment:
      - PRIVATE_KEY=${NORDLYNX_PRIVATE_KEY}
      - NET_LOCAL=192.168.3.0/24 192.168.5.0/24
      - DNS=103.86.96.100,103.86.99.100
    volumes:
      - nordlynx_config:/config
    ports:
      - "30024:30024" # QBittorrent WebUI
      - "3000:3000"  # Firefox Remote Debugging
      - "51413:51413/udp" # QBittorrent UDP
      - "51413:51413/tcp" # QBittorrent TCP
    networks:
      - networks_vpn_net
      - networks_infra_net

  # ðŸ’¾ qBittorrent â€” routed through NordLynx
  qbittorrent:
    image: lscr.io/linuxserver/qbittorrent:latest
    container_name: qbittorrent
    restart: unless-stopped
    depends_on:
      - nordlynx
    network_mode: "service:nordlynx"
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/Mexico_City
      - WEBUI_PORT=30024
    volumes:
      - /mnt/HomeLab/QBittorrent/config:/config
      - /mnt/HomeLab/Media-Server/downloads:/downloads

  firefox:
    image: lscr.io/linuxserver/firefox:latest
    container_name: firefox
    restart: unless-stopped
    depends_on:
      - nordlynx
    network_mode: "service:nordlynx"
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/Mexico_City
    volumes:
      - /mnt/HomeLab/Privacy/Firefox/config:/config
    security_opt:
      - seccomp:unconfined
    shm_size: "1gb"
